<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Latazed</title>
<style>
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 1em;
  }
  th, td {
    border: 1px solid #999;
    padding: 0.5em 1em;
    text-align: center;
  }
  th {
    background-color: #eee;
  }
  button {
    padding: 0.3em 0.6em;
    cursor: pointer;
  }
</style>
<script>
function formatDate(date) {
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
  const year = date.getFullYear();
  return `${day}/${month}/${year}`;
}
function getDataArray() {
  const arr = localStorage.getItem('dateCalcDataArray');
  if (arr) return JSON.parse(arr);
  return [];
}

function setDataArray(arr) {
  localStorage.setItem('dateCalcDataArray', JSON.stringify(arr));
}

function calculateForDate(inputDateStr) {
  const inputDate = new Date(inputDateStr);
  const date21 = new Date(inputDate);
  date21.setDate(date21.getDate() + 21);
  const date28 = new Date(inputDate);
  date28.setDate(date28.getDate() + 28);

  const today = new Date();
  const daysUntil21 = Math.floor((date21 - today) / (1000 * 60 * 60 * 24));
  const daysUntil28 = Math.floor((date28 - today) / (1000 * 60 * 60 * 24));

  return {
    inputDate: inputDateStr,
    date21: date21.toISOString().substring(0,10),
    daysUntil21,
    date28: date28.toISOString().substring(0,10),
    daysUntil28
  };
}

function addDate() {
  const inputDateStr = document.getElementById('inputDate').value;
  if(!inputDateStr) {
    alert('Please enter a date.');
    return;
  }
  let arr = getDataArray();
  if (arr.some(entry => entry.inputDate === inputDateStr)) {
    alert("Date already saved.");
    return;
  }
  const data = calculateForDate(inputDateStr);
  arr.push(data);
  setDataArray(arr);
  displaySavedDates();
}

function displaySavedDates() {
  const arr = getDataArray();
  const div = document.getElementById('savedDates');
  if (!arr.length) {
    div.innerHTML = "<p>No dates entered yet.</p>";
    return;
  }
  let html = `<table style="font-size: 24px; font-family: arial">
    <thead>
      <tr>
        <th>Date</th>
        <th>Scheduled</th>
        <th>S</th>
        <th>Earliest</th>
        <th>E</th>
        <th>Remove</th>
      </tr>
    </thead><tbody>`;
  
  arr.forEach((data, idx) => {
    let xinputDate = new Date(data.inputDate);
    let xdate21 = new Date(data.date21);
    let xdate28 = new Date(data.date28);
    xinputDate = formatDate(xinputDate);
    xdate21 = formatDate(xdate21);
    xdate28 = formatDate(xdate28);

    html += `<tr>
      <td>${xinputDate}</td>
      <td>${xdate28}</td>
      <td>${data.daysUntil28}</td>
      <td>${xdate21}</td>
      <td>${data.daysUntil21}</td>
      <td><button onclick="removeDate(${idx})">-</button></td>
    </tr>`;
  });
  
  html += `</tbody></table>`;
  div.innerHTML = html;
}

function removeDate(index) {
  let arr = getDataArray();
  arr.splice(index, 1);
  setDataArray(arr);
  displaySavedDates();
}

window.onload = displaySavedDates;
</script>
</head>
<body>
  <h2>Latazed</h2>
  
  <label for="inputDate">Enter a date:</label>
  <input type="date" id="inputDate" />
  <button onclick="addDate()">Add Date</button>

  <h3>Saved Dates:</h3>
  <div id="savedDates"></div>


</body>
</html>
